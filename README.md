# Primitive DB — Консольная база данных

Простая консольная система управления базами данных с поддержкой таблиц, типизированных столбцов и полного набора CRUD-операций. Проект реализован в процедурном стиле с использованием современных практик разработки на Python: управление зависимостями через Poetry, контроль качества кода через Ruff, применение декораторов для централизованной обработки ошибок и логирования, а также замыканий для кэширования результатов запросов.

## Возможности

### Управление таблицами
- `create_table <имя> <столбец1:тип> <столбец2:тип> ...` — создание таблицы с указанием типов столбцов (поддерживаются типы: `int`, `str`, `bool`). Столбец `ID:int` добавляется автоматически.
- `drop_table <имя>` — удаление таблицы (с запросом подтверждения).
- `list_tables` — вывод списка всех существующих таблиц.
- `info <имя>` — отображение структуры таблицы (имена и типы столбцов).

### Работа с данными
- `insert into <таблица> values (<значение1>, <значение2>, ...)` — добавление записи. Значение для столбца `ID` генерируется автоматически.
- `select from <таблица> [where <столбец> = <значение>]` — выборка записей (с фильтрацией по условию или без).
- `update <таблица> set <столбец> = <значение> where <столбец> = <значение>` — обновление записей по условию.
- `delete from <таблица> where <столбец> = <значение>` — удаление записей по условию (с запросом подтверждения).

### Особенности реализации
- Централизованная обработка ошибок через декоратор `@handle_db_errors`.
- Защита от случайного удаления данных через декоратор `@confirm_action`.
- Замер времени выполнения операций через декоратор `@log_time`.
- Кэширование результатов одинаковых запросов `select` с использованием замыкания.
- Все данные персистентны — сохраняются в JSON-файлах (`db_meta.json` для метаданных, `data/<таблица>.json` для записей).

## Технологии

- **Управление проектом**: Poetry, Makefile, Git
- **Качество кода**: Ruff (проверка соответствия PEP8)
- **Стандартные библиотеки**: `json`, `shlex`, `pathlib`, `time`
- **Внешние зависимости**: `prettytable` (форматированный вывод), `prompt` (удобный ввод данных)
- **Архитектурные паттерны**: декораторы, замыкания, процедурное программирование

## Установка

```bash
# Клонирование репозитория
git clone https://github.com/ваш-логин/project2_makarova.git
cd project2_makarova

# Установка зависимостей
make install
# или
poetry install
```

## Пример использования

***База данных***

***Операции с данными***
Функции:
<command> insert into <имя_таблицы> values (<значение1>, <значение2>, ...) - создать запись
<command> select from <имя_таблицы> where <столбец> = <значение> - прочитать записи по условию
<command> select from <имя_таблицы> - прочитать все записи
<command> update <имя_таблицы> set <столбец> = <значение> where <столбец> = <значение> - обновить запись
<command> delete from <имя_таблицы> where <столбец> = <значение> - удалить запись
<command> info <имя_таблицы> - вывести информацию о таблице
<command> create_table <имя_таблицы> <столбец1:тип> ... - создать таблицу
<command> list_tables - показать список всех таблиц
<command> drop_table <имя_таблицы> - удалить таблицу
<command> exit - выход из программы
<command> help - справочная информация

>>> Введите команду: drop_table users
Вы уверены, что хотите выполнить "удаление таблицы"? [y/n]: y
Таблица "users" успешно удалена.

>>> Введите команду: create_table users name:str age:int
Таблица "users" успешно создана со столбцами: ID:int, name:str, age:int

>>> Введите команду: insert into users values ("Masha", 30)

[DEBUG] Функция insert выполнилась за 0.001 секунд.
Запись с ID=2 успешно добавлена в таблицу "users".

>>> Введите команду: select from users

[DEBUG] Функция select выполнилась за 0.012 секунд.
+----+--------+-----+
| ID |  name  | age |
+----+--------+-----+
| 1  | Sergei |  28 |
| 2  | Masha  |  30 |
+----+--------+-----+

>>> Введите команду: drop_table users
Вы уверены, что хотите выполнить "удаление таблицы"? [y/n]: y
Таблица "users" успешно удалена.

>>> Введите команду: exit